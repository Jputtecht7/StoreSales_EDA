---
title: "StoreSales_EDA"
format: html
editor: visual
---

```{r}
library(readr)
library(ggplot2)
library(plotly)
library(dplyr)
library(lubridate)
```

```{r}
holidays_events <- read_csv("holidays_events.csv")
oil <- read_csv("oil.csv")
sample_submission <- read_csv("sample_submission.csv")
test <- read_csv("test.csv")
train <- read_csv("train.csv")
transactions <- read_csv("transactions.csv")
stores <- read_csv("stores.csv")
```

### Train Data

#### Sales Vs. On promotion

```{r}
# Show correlation between sales and on promotion for each type of prodcut
train_subset <- train %>%
  group_by(family) %>%
  slice_sample(n = 1000, replace = FALSE) %>% # Randomly select up to 1000 rows per product
  ungroup()

plot_family <- function(family_name) {
  family_data <- subset(train_subset, family == family_name)  # Filter data for the products
  
  ggplot(family_data, aes(x = onpromotion, y = sales)) +
    geom_point(color = "blue", size = 2, alpha = 0.7) +
    geom_smooth(method = "lm", color = "red", se = FALSE) + # Add linear regression line
    labs(
      title = paste("Correlation between Total Sales and Promotions for", family_name),
      x = "Items Promoted (onpromotion)",
      y = "Total Sales"
    ) +
    theme_minimal()
}

# Generate plots for each product
unique_items <- unique(train_subset$family)

sales.onpromotion <- lapply(unique_items, function(family) {
  plot_family(family)  # Generate plot for each family
})

# Display all plots
sales.onpromotion
```

### Sales for each product compared over store number

```{r}
plot_sales_by_family <- function(train, family_type) {
  # Filter data for the given family type and calculate total sales by store
  filtered_data <- train %>%
    filter(family == family_type) %>%
    group_by(store_nbr) %>%
    summarise(total_sales = sum(sales, na.rm = TRUE), .groups = "drop")
  
  # Create the ggplot
  p <- ggplot(filtered_data, aes(x = factor(store_nbr), y = total_sales)) +
    geom_bar(stat = "identity", fill = "skyblue", color = "black") +
    labs(
      title = paste("Total Sales for", family_type, "Family by Store"),
      x = "Store Number",
      y = "Total Sales"
    ) +
    theme_minimal()
  
  # Convert to an interactive plotly plot
  ggplotly(p)
}

unique_families <- unique(train$family)
plots <- lapply(unique_families, function(family) {
  plot_sales_by_family(train, family)
})

# Display the plot for the first family
plots
```

```{r}
ggplot(holidays_events, aes(x = date, y = type, color = type)) +
  geom_point(size = 2) +
  labs(
    title = "Holidays from 2012 to 2017",
    x = "Date",
    y = "Holiday Type"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r}
ggplot(stores, aes(x = type, y = store_nbr, fill = type)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Store Numbers by Type",
    x = "Store Type",
    y = "Store Number"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

Amount of Transactions by days of the Month

```{r}
# Convert date column to Date type
transactions$date <- as.Date(transactions$date)

# Extract the day of the month
transactions <- transactions %>%
  mutate(day_of_month = day(date))  # Extract day from date

# Summarize total transactions by day of the month
transactions_by_day <- transactions %>%
  group_by(day_of_month) %>%
  summarise(total_transactions = sum(transactions, na.rm = TRUE))

# Create a plotly plot
plot_ly(transactions_by_day, x = ~day_of_month, y = ~total_transactions, type = 'scatter', mode = 'lines+markers',
        marker = list(color = 'rgba(34, 139, 34, .9)'),
        line = list(color = 'rgba(0, 100, 0, .9)')) %>%
  layout(title = "Total Transactions by Day of Month",
         xaxis = list(title = "Day of Month"),
         yaxis = list(title = "Total Transactions"))
# Convert date column to Date type and extract day of the month
transactions <- transactions %>%
  mutate(date = as.Date(date),
         day_of_month = day(date))

# Filter out the 29th, 30th, and 31st days
filtered_df <- transactions %>%
  filter(day_of_month < 29)

# Summarize total transactions by day of the month
transactions_by_day <- filtered_df %>%
  group_by(day_of_month) %>%
  summarise(total_transactions = sum(transactions, na.rm = TRUE))

# Create a plotly plot
plot_ly(transactions_by_day, x = ~day_of_month, y = ~total_transactions, type = 'scatter', mode = 'lines+markers',
        marker = list(color = 'rgba(100, 149, 237, .9)'),
        line = list(color = 'rgba(65, 105, 225, .9)')) %>%
  layout(title = "Total Transactions by Day of Month (Excluding 29th, 30th, 31st)",
         xaxis = list(title = "Day of Month"),
         yaxis = list(title = "Total Transactions"))
# Convert date column to Date type and extract day of the month
transactions <- transactions %>%
  mutate(date = as.Date(date),
         day_of_month = day(date))

# Filter out the 29th, 30th, 31st days and any data from January
filtered_df <- transactions %>%
  filter(day_of_month < 29, month(date) != 1)

# Summarize total transactions by day of the month
transactions_by_day <- filtered_df %>%
  group_by(day_of_month) %>%
  summarise(total_transactions = sum(transactions, na.rm = TRUE))

# Create a plotly plot
plot_ly(transactions_by_day, x = ~day_of_month, y = ~total_transactions, type = 'scatter', mode = 'lines+markers',
        marker = list(color = 'rgba(255, 99, 71, .9)'),
        line = list(color = 'rgba(255, 69, 0, .9)')) %>%
  layout(title = "Total Transactions by Day of Month (Excluding 29th, 30th, 31st and January)",
         xaxis = list(title = "Day of Month"),
         yaxis = list(title = "Total Transactions"))
# Convert date column to Date type and extract day of the month
transactions <- transactions %>%
  mutate(date = as.Date(date),
         day_of_month = day(date))

# Filter out the 29th, 30th, 31st days and any data from January and December
filtered_df <- transactions %>%
  filter(day_of_month < 29, !month(date) %in% c(1, 12))

# Summarize total transactions by day of the month
transactions_by_day <- filtered_df %>%
  group_by(day_of_month) %>%
  summarise(total_transactions = sum(transactions, na.rm = TRUE))

# Create a plotly plot
plot_ly(transactions_by_day, x = ~day_of_month, y = ~total_transactions, type = 'scatter', mode = 'lines+markers',
        marker = list(color = 'rgba(255, 140, 0, .9)'),
        line = list(color = 'rgba(255, 69, 0, .9)')) %>%
  layout(title = "Total Transactions by Day of Month (Excluding 29th, 30th, 31st, January, and December)",
         xaxis = list(title = "Day of Month"),
         yaxis = list(title = "Total Transactions"))

```

```{r}

```
